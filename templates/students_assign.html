<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Assigned Students</title>

  <style>
    body{
      font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Arial,sans-serif;
      background:#f0f2f5;
      margin:0;
    }
    .header{
      background:white;
      padding:14px 20px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom:1px solid #e7e7e7;
    }
    .logo-img{height:42px}
    .page-title{padding:18px 20px;font-size:20px;font-weight:700;color:#333}

    .table-wrapper{
      max-width:1100px;
      margin:10px auto;
      background:white;
      padding:16px;
      border-radius:8px;
      box-shadow:0 6px 18px rgba(0,0,0,0.05);
    }

    table{width:100%;border-collapse:collapse}
    th{
      background:#fafafa;
      padding:12px;
      text-align:left;
      border-bottom:1px solid #eee;
      font-weight:700;
      color:#555;
    }
    td{
      padding:12px;
      border-bottom:1px solid #f1f1f1;
      font-size:15px;
    }

    .student-id-link{
      color:#ff6f00;
      font-weight:700;
      text-decoration:none;
    }

    .empty{
      padding:30px;
      text-align:center;
      color:#777;
    }
  </style>
</head>

<body>

  <header class="header">
    <div><img src="{{ url_for('static', filename='logo_icon.jpg') }}" class="logo-img"></div>

    <div style="font-weight:700;font-size:18px;">
      PV - Assigned Students
    </div>

    <div>
      <a href="/logout" style="text-decoration:none;color:#ff6f00;font-weight:700">Logout</a>
    </div>
  </header>

  <div class="page-title">Assigned Students</div>

  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Student ID</th>
          <th>Name</th>
          <th>Phone</th>
          <th>District</th>
          
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>

    <div id="empty" class="empty" style="display:none;">No students assigned.</div>
  </div>

  <script>
    async function loadAssignedStudents() {
  try {
    const res = await fetch('/api/assigned-students');
    const data = await res.json();
    if (data.error) {
      console.error(data.error);
      return;
    }
    // TODO: replace the DOM list rendering with your own list container logic
    // Example: assume <div id="assigned-list"></div> exists
    const container = document.getElementById('assigned-list');
    if (!container) return;
    container.innerHTML = '';
    data.students.forEach(s => {
      const el = document.createElement('div');
      el.className = 'student-row';
      el.innerHTML = `
        <a href="/pv/${s.studentId}">${s.studentId} - ${s.studentName}</a>
        <span>${s.district}</span>
        <strong style="margin-left:10px">${s.status || 'NEW'}</strong>
      `;
      container.appendChild(el);
    });
  } catch (err) {
    console.error('Failed to load assigned students', err);
  }
}

// initial load + interval
loadAssignedStudents();
setInterval(loadAssignedStudents, 5000); // every 5s
    async function loadAssigned(){
      const res = await fetch('/api/assigned-students');

      if(!res.ok){
        document.getElementById('tbody').innerHTML =
          '<tr><td colspan="6">Error loading data</td></tr>';
        return;
      }

      const { students } = await res.json();
      const t = document.getElementById('tbody');
      t.innerHTML = "";

      if(!students || students.length === 0){
        document.getElementById('empty').style.display = 'block';
        return;
      }

      document.getElementById('empty').style.display = 'none';

      students.forEach((s, i) => {
        const tr = document.createElement('tr');

        tr.innerHTML = `
          <td>${i+1}</td>
          <td><a class="student-id-link" href="/student/${s.studentId}">${s.studentId}</a></td>
          <td>${s.studentName || ''}</td>
          <td>${s.phoneNumber || ''}</td>
          <td>${s.district || ''}</td>
         
        `;

        t.appendChild(tr);
      });
    }

    loadAssigned();
  </script>

</body>
</html>
